{% extends 'base.html' %}

{% block page_title %}
<div class="page-title">
    <div><h1><i class="icon-shield"></i> Pelatihan Model dengan Optimasi Neuron</h1></div>
</div>
{% endblock %}

{% block breadcrumbs %}
<div id="breadcrumbs">
    <ul class="breadcrumb">
        <li class="active"><i class="icon-home"></i> Home</li>
    </ul>
</div>
{% endblock %}

{% block content %}
<h3>Train Model dengan Optimasi Neuron Otomatis</h3>

<div id="result-check" style="display: none;" class="alert alert-info">
    <p><strong>üìÅ Hasil perhitungan sebelumnya ditemukan!</strong></p>
    <p>Apa yang ingin Anda lakukan?</p>
    <button id="use-existing" class="btn btn-success">
        <i class="icon-download"></i> Gunakan Hasil Sebelumnya
    </button>
    <button id="train-new" class="btn btn-primary">
        <i class="icon-refresh"></i> Latih Model Baru dengan Optimasi
    </button>
</div>

<form id="upload-form" method="post" enctype="multipart/form-data" style="display: none;">
    <div class="form-group">
        <label for="file"><strong>Pilih File CSV untuk Training:</strong></label>
        <input type="file" name="file" id="file" accept=".csv" required class="form-control">
        <small class="form-text text-muted">
            File harus berisi kolom "Status" sebagai target dan fitur-fitur lainnya.
        </small>
    </div>
    <button type="submit" class="btn btn-primary mt-2">
        <i class="icon-upload"></i> Unggah dan Latih Model dengan Optimasi
    </button>
</form>

<div id="loading" style="display: none;">
    <div class="alert alert-info">
        <h5><span class="loading-spinner"></span> Sedang melakukan optimasi neuron...</h5>
        <p><strong>Proses optimasi mungkin memakan waktu beberapa menit:</strong></p>
        <ul>
            <li>üîç <strong>Learning Curve Analysis</strong> - Menganalisis pola performa vs jumlah neuron</li>
            <li>üéØ <strong>Grid Search</strong> - Mencari konfigurasi neuron optimal</li>
            <li>‚ö° <strong>Training Model Final</strong> - Melatih model dengan konfigurasi terbaik</li>
        </ul>
        <div class="progress mt-3">
            <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%"></div>
        </div>
    </div>
</div>

<div id="statusMessage" class="mt-2"></div>

<!-- Section untuk Architecture Comparison -->
<div id="architecture-comparison" style="display: none;" class="mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0"><i class="icon-bar-chart"></i> üìä Perbandingan Arsitektur MLP</h4>
        </div>
        <div class="card-body">
            <!-- Best Architecture Info -->
            <div id="best-architecture-info" class="alert alert-success mt-4" style="display: none;">
                <h5><i class="icon-trophy"></i> Arsitektur Terbaik: <span id="best-architecture-name"></span></h5>
                <p class="mb-1"><strong>Hyperparameters:</strong> <span id="best-hyperparams"></span></p>
                <p class="mb-0">
                    <strong>Validation Accuracy:</strong> <span id="best-accuracy"></span>% | 
                    <strong>Macro F1:</strong> <span id="best-macro-f1"></span>% |
                    <strong>Macro Precision:</strong> <span id="best-macro-precision"></span>% |
                    <strong>Macro Recall:</strong> <span id="best-macro-recall"></span>%
                </p>
                <small class="text-muted mt-2 d-block">
                    <i class="icon-info"></i> Arsitektur ini dipilih berdasarkan <strong>Macro F1 Score tertinggi</strong> 
                    (<span id="best-macro-f1-criteria"></span>%) sebagai kriteria utama.
                </small>
            </div>

            <!-- Data Consistency Check -->
            <div id="consistency-check" class="alert alert-info mt-2" style="display: none;">
                <h6><i class="icon-check"></i> Validasi Konsistensi Data</h6>
                <p id="consistency-message"></p>
                <button id="run-consistency-check" class="btn btn-sm btn-outline-info">
                    <i class="icon-refresh"></i> Cek Konsistensi Data
                </button>
            </div>

            <!-- Chart Controls -->
            <div class="mt-4">
                <div class="col-md-12">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-primary active" data-chart-type="performance">
                            <i class="icon-chart-line"></i> Metrik Performa
                        </button>
                        <button type="button" class="btn btn-outline-secondary" data-chart-type="resources">
                            <i class="icon-desktop"></i> Penggunaan Resource
                        </button>
                        <button type="button" class="btn btn-outline-secondary" data-chart-type="efficiency">
                            <i class="icon-clock"></i> Efisiensi Training
                        </button>
                        <button type="button" class="btn btn-outline-secondary" data-chart-type="training-progress">
                            <i class="icon-graph"></i> Progress Training
                        </button>
                    </div>
                </div>
            </div>

            <!-- Performance Metrics Chart -->
            <div id="performance-chart" class="chart-section">
                <div class="mt-4">
                    <div class="col-md-8">
                        <div class="chart-container">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="icon-info"></i> Keterangan Metrik</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>Macro F1:</strong> Metrik utama untuk class imbalance</p>
                                <p><strong>Accuracy:</strong> Persentase prediksi benar secara keseluruhan</p>
                                <p><strong>Precision:</strong> Akurasi prediksi positif</p>
                                <p><strong>Recall:</strong> Kemampuan menemukan semua kasus positif</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resource Usage Chart -->
            <div id="resources-chart" class="chart-section" style="display: none;">
                <div class="row">
                    <div class="col-md-8">
                        <div class="chart-container">
                            <canvas id="resourcesChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="icon-info"></i> Keterangan Resource</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>Parameter Count:</strong> Jumlah total parameter model</p>
                                <p><strong>Memory Usage:</strong> Rata-rata penggunaan memori selama training</p>
                                <p><strong>Training Time:</strong> Waktu total training dalam detik</p>
                                <p><strong>Inference Time:</strong> Waktu prediksi per sample (ms)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Efficiency Chart -->
            <div id="efficiency-chart" class="chart-section" style="display: none;">
                <div class="row">
                    <div class="col-md-8">
                        <div class="chart-container">
                            <canvas id="efficiencyChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card mt-4">
                            <div class="card-header">
                                <h6><i class="icon-info"></i> Keterangan Efisiensi</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>Accuracy/Time:</strong> Akurasi per detik training</p>
                                <p><strong>Accuracy/Params:</strong> Akurasi per juta parameter</p>
                                <p><strong>Accuracy/Memory:</strong> Akurasi per MB memori</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Training Progress Chart -->
            <div id="training-progress-chart" class="chart-section" style="display: none;">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="icon-graph"></i> Progress Training Semua Arsitektur</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="accuracyProgressChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="lossProgressChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Comparison Table -->
            <div class="mt-4">
                <div class="col-md-12">
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5><i class="icon-table"></i> üìã Tabel Perbandingan Detail Arsitektur</h5>
                            <small class="text-muted">Data yang sama persis dengan Arsitektur Terbaik</small>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered table-striped table-hover" id="comparison-table">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th>Arsitektur</th>
                                            <th>Macro F1</th>
                                            <th>Val Accuracy</th>
                                            <th>Macro Precision</th>
                                            <th>Macro Recall</th>
                                            <th>Inference Time</th>
                                            <th>Memory</th>
                                            <th>Training Time</th>
                                            <th>Parameters</th>
                                            <th>Epochs Used</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Section untuk optimization results -->
<div id="optimization-results" style="display: none;" class="mt-4">
    <!-- ... (kode optimization results tetap sama) ... -->
</div>

<div id="review-table-box" style="display: none;">
    <div class="mt-3">
        <div class="btn-group" role="group">
            <button id="clear-data" class="btn btn-danger">
                <i class="icon-trash"></i> Hapus Data & Model
            </button>
            <button class="btn btn-outline-primary" onclick="window.location='/perhitungan/download/model_mlp_custom.keras'">
                <i class="icon-download"></i> Download Model
            </button>
            <button class="btn btn-outline-primary" onclick="window.location='/perhitungan/download/label_encoder.pkl'">
                <i class="icon-download"></i> Download Label Encoder
            </button>
            <button class="btn btn-outline-primary" onclick="window.location='/perhitungan/download/hasil_perhitungan.csv'">
                <i class="icon-download"></i> Download Hasil
            </button>
            <button id="load-saved-data" class="btn btn-outline-secondary">
                <i class="icon-refresh"></i> Muat Ulang Data
            </button>
            <button id="load-visualization-data" class="btn btn-outline-info">
                <i class="icon-chart"></i> Muat Data Visualisasi
            </button>
            <button id="debug-cache" class="btn btn-outline-warning">
                <i class="icon-bug"></i> Debug Cache
            </button>
            <button id="validate-consistency" class="btn btn-outline-success">
                <i class="icon-check"></i> Validasi Konsistensi
            </button>
        </div>
    </div>

    <!-- Info data -->
    <div id="data-info" class="mt-3"></div>

    <!-- Tabel data -->
    <div class="card mt-4">
        <div class="card-header">
            <h5><i class="icon-table"></i> Hasil Prediksi</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead id="table-header" class="thead-light"></thead>
                    <tbody id="reviews-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Evaluasi model -->
    <div id="eval-info" class="mt-4"></div>
</div>
{% endblock %}

{% block extra_script %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Global variables untuk menyimpan chart instances
let learningCurveChart = null;
let accuracyChart = null;
let lossChart = null;
let performanceChart = null;
let resourcesChart = null;
let efficiencyChart = null;
let accuracyProgressChart = null;
let lossProgressChart = null;

// Global variables untuk menyimpan data chart
let currentComparisonData = null;
let currentTrainingHistories = null;

// Resize handler untuk chart
let resizeTimer;
$(window).on('resize', function() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function() {
        if (currentComparisonData) {
            recreateAllCharts();
        }
    }, 250);
});

function recreateAllCharts() {
    if (performanceChart && currentComparisonData) {
        performanceChart.destroy();
        createPerformanceChart(currentComparisonData);
    }
    if (resourcesChart && currentComparisonData) {
        resourcesChart.destroy();
        createResourcesChart(currentComparisonData);
    }
    if (efficiencyChart && currentComparisonData) {
        efficiencyChart.destroy();
        createEfficiencyChart(currentComparisonData);
    }
    if (accuracyProgressChart && currentTrainingHistories) {
        accuracyProgressChart.destroy();
        lossProgressChart.destroy();
        createTrainingProgressCharts(currentTrainingHistories);
    }
}

// Fungsi untuk menyembunyikan opsi pilihan setelah dipilih
function hideSelectionOptions() {
    $("#result-check").addClass('hidden-section');
    $("#cache-info").addClass('hidden-section');
    console.log("‚úÖ Opsi pilihan disembunyikan");
}

// Fungsi untuk mengurutkan data arsitektur - DITAMBAHKAN
function sortArchitectureData(architectureResults) {
    if (!architectureResults) return architectureResults;
    
    const desiredOrder = [
        "MLP-A (Sederhana)",
        "MLP-B (Sedang)",
        "MLP-C (Dalam)", 
        "MLP-D (Wide + Shallow)"
    ];
    
    return architectureResults.sort((a, b) => {
        const indexA = desiredOrder.indexOf(a.architecture);
        const indexB = desiredOrder.indexOf(b.architecture);
        return indexA - indexB;
    });
}

// Fungsi untuk membuat chart performa - DIPERBAIKI
function createPerformanceChart(comparisonData) {
    const ctx = document.getElementById('performanceChart').getContext('2d');
    
    if (performanceChart) {
        performanceChart.destroy();
    }
    
    performanceChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: comparisonData.labels,
            datasets: [
                {
                    label: 'Macro F1',
                    data: comparisonData.macro_f1,
                    backgroundColor: 'rgba(40, 167, 69, 0.8)',
                    borderColor: 'rgba(40, 167, 69, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: 'Validation Accuracy',
                    data: comparisonData.accuracy,
                    backgroundColor: 'rgba(54, 162, 235, 0.8)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: 'Macro Precision',
                    data: comparisonData.macro_precision || comparisonData.precision,
                    backgroundColor: 'rgba(255, 99, 132, 0.8)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: 'Macro Recall',
                    data: comparisonData.macro_recall || comparisonData.recall,
                    backgroundColor: 'rgba(75, 192, 192, 0.8)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Perbandingan Metrik Performa Arsitektur MLP',
                    font: { size: 16 }
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            return `${context.dataset.label}: ${context.parsed.y}%`;
                        }
                    }
                },
                legend: {
                    position: 'top',
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Arsitektur MLP'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Persentase (%)'
                    },
                    min: 0,
                    max: 100
                }
            }
        }
    });
}

// Fungsi untuk membuat chart resource usage
function createResourcesChart(comparisonData) {
    const ctx = document.getElementById('resourcesChart').getContext('2d');
    
    if (resourcesChart) {
        resourcesChart.destroy();
    }
    
    resourcesChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: comparisonData.labels,
            datasets: [
                {
                    label: 'Training Time (s)',
                    data: comparisonData.training_time,
                    backgroundColor: 'rgba(153, 102, 255, 0.8)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: 'Memory Usage (MB)',
                    data: comparisonData.memory_usage,
                    backgroundColor: 'rgba(255, 159, 64, 0.8)',
                    borderColor: 'rgba(255, 159, 64, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: 'Inference Time (ms)',
                    data: comparisonData.inference_time,
                    backgroundColor: 'rgba(255, 205, 86, 0.8)',
                    borderColor: 'rgba(255, 205, 86, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: 'Parameters (normalized)',
                    data: comparisonData.parameters.map(p => p / 1000000),
                    backgroundColor: 'rgba(201, 203, 207, 0.8)',
                    borderColor: 'rgba(201, 203, 207, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Penggunaan Resource Arsitektur MLP',
                    font: { size: 16 }
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            if (context.dataset.label === 'Parameters (normalized)') {
                                const originalValue = comparisonData.parameters[context.dataIndex];
                                return `Parameters: ${originalValue.toLocaleString()}`;
                            } else if (context.dataset.label === 'Training Time (s)') {
                                return `Training Time: ${context.parsed.y}s`;
                            } else if (context.dataset.label === 'Inference Time (ms)') {
                                return `Inference Time: ${context.parsed.y}ms`;
                            } else {
                                return `${context.dataset.label}: ${context.parsed.y}MB`;
                            }
                        }
                    }
                },
                legend: {
                    position: 'top',
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Arsitektur MLP'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Nilai'
                    },
                    beginAtZero: true
                }
            }
        }
    });
}

// Fungsi untuk membuat chart efisiensi
function createEfficiencyChart(comparisonData) {
    const ctx = document.getElementById('efficiencyChart').getContext('2d');
    
    if (efficiencyChart) {
        efficiencyChart.destroy();
    }
    
    // Hitung metrik efisiensi
    const accuracyPerTime = comparisonData.accuracy.map((acc, i) => 
        comparisonData.training_time[i] > 0 ? (acc / comparisonData.training_time[i]).toFixed(2) : 0
    );
    
    const accuracyPerMemory = comparisonData.accuracy.map((acc, i) => 
        comparisonData.memory_usage[i] > 0 ? (acc / comparisonData.memory_usage[i]).toFixed(2) : 0
    );
    
    const accuracyPerParam = comparisonData.accuracy.map((acc, i) => 
        comparisonData.parameters[i] > 0 ? (acc / (comparisonData.parameters[i] / 1000000)).toFixed(2) : 0
    );
    
    efficiencyChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: comparisonData.labels,
            datasets: [
                {
                    label: 'Accuracy/Time (acc/s)',
                    data: accuracyPerTime,
                    backgroundColor: 'rgba(75, 192, 192, 0.8)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: 'Accuracy/Memory (acc/MB)',
                    data: accuracyPerMemory,
                    backgroundColor: 'rgba(255, 99, 132, 0.8)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: 'Accuracy/Params (acc/M param)',
                    data: accuracyPerParam,
                    backgroundColor: 'rgba(255, 205, 86, 0.8)',
                    borderColor: 'rgba(255, 205, 86, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Efisiensi Training Arsitektur MLP',
                    font: { size: 16 }
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            return `${context.dataset.label}: ${context.parsed.y}`;
                        }
                    }
                },
                legend: {
                    position: 'top',
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Arsitektur MLP'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Nilai Efisiensi'
                    },
                    beginAtZero: true
                }
            }
        }
    });
}

// Fungsi untuk membuat training progress charts
function createTrainingProgressCharts(trainingHistories) {
    if (!trainingHistories) {
        console.log("‚ùå Tidak ada training histories untuk membuat chart");
        return;
    }
    
    // Accuracy Progress Chart
    const accuracyCtx = document.getElementById('accuracyProgressChart').getContext('2d');
    if (accuracyProgressChart) accuracyProgressChart.destroy();
    
    const accuracyDatasets = [];
    const lossDatasets = [];
    
    const colors = [
        { border: 'rgb(54, 162, 235)', background: 'rgba(54, 162, 235, 0.1)' },
        { border: 'rgb(255, 99, 132)', background: 'rgba(255, 99, 132, 0.1)' },
        { border: 'rgb(75, 192, 192)', background: 'rgba(75, 192, 192, 0.1)' },
        { border: 'rgb(255, 205, 86)', background: 'rgba(255, 205, 86, 0.1)' }
    ];
    
    let colorIndex = 0;
    for (const [modelName, history] of Object.entries(trainingHistories)) {
        const epochs = Array.from({length: history.accuracy.length}, (_, i) => i + 1);
        const color = colors[colorIndex % colors.length];
        
        // Accuracy dataset
        accuracyDatasets.push({
            label: `${modelName} Training`,
            data: history.accuracy.map(acc => acc * 100),
            borderColor: color.border,
            backgroundColor: color.background,
            borderWidth: 2,
            tension: 0.4
        });
        
        accuracyDatasets.push({
            label: `${modelName} Validation`,
            data: history.val_accuracy.map(acc => acc * 100),
            borderColor: color.border,
            backgroundColor: color.background,
            borderWidth: 2,
            tension: 0.4,
            borderDash: [5, 5]
        });
        
        // Loss dataset
        lossDatasets.push({
            label: `${modelName} Training`,
            data: history.loss,
            borderColor: color.border,
            backgroundColor: color.background,
            borderWidth: 2,
            tension: 0.4
        });
        
        lossDatasets.push({
            label: `${modelName} Validation`,
            data: history.val_loss,
            borderColor: color.border,
            backgroundColor: color.background,
            borderWidth: 2,
            tension: 0.4,
            borderDash: [5, 5]
        });
        
        colorIndex++;
    }
    
    const maxEpochs = Math.max(...Object.values(trainingHistories).map(h => h.accuracy.length));
    const epochLabels = Array.from({length: maxEpochs}, (_, i) => i + 1);
    
    accuracyProgressChart = new Chart(accuracyCtx, {
        type: 'line',
        data: {
            labels: epochLabels,
            datasets: accuracyDatasets
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Training & Validation Accuracy Progress'
                }
            },
            scales: {
                y: {
                    title: {
                        display: true,
                        text: 'Accuracy (%)'
                    },
                    min: 0,
                    max: 100
                },
                x: {
                    title: {
                        display: true,
                        text: 'Epoch'
                    }
                }
            }
        }
    });
    
    // Loss Progress Chart
    const lossCtx = document.getElementById('lossProgressChart').getContext('2d');
    if (lossProgressChart) lossProgressChart.destroy();
    
    lossProgressChart = new Chart(lossCtx, {
        type: 'line',
        data: {
            labels: epochLabels,
            datasets: lossDatasets
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Training & Validation Loss Progress'
                }
            },
            scales: {
                y: {
                    title: {
                        display: true,
                        text: 'Loss'
                    },
                    beginAtZero: true
                },
                x: {
                    title: {
                        display: true,
                        text: 'Epoch'
                    }
                }
            }
        }
    });
}

// Fungsi untuk mengisi tabel perbandingan - DIPERBAIKI (SIMPLE VERSION)
function renderComparisonTable(architectureResults, bestArchitectureName) {
    const tbody = $('#comparison-table tbody');
    tbody.empty();
    
    if (!architectureResults || architectureResults.length === 0) {
        tbody.html('<tr><td colspan="11" class="text-center">Tidak ada data perbandingan</td></tr>');
        return;
    }
    
    // Urutkan data arsitektur
    const sortedResults = sortArchitectureData(architectureResults);
    
    sortedResults.forEach(arch => {
        const isBest = arch.architecture === bestArchitectureName;
        const rowClass = isBest ? 'table-success' : '';
        
        // Tentukan status berdasarkan performa
        let status = '';
        if (isBest) {
            status = '<span class="badge bg-success">Best Model</span>';
        } else if (arch.macro_f1 >= 90) {
            status = '<span class="badge bg-primary">Excellent</span>';
        } else if (arch.macro_f1 >= 80) {
            status = '<span class="badge bg-warning">Good</span>';
        } else {
            status = '<span class="badge bg-secondary">Fair</span>';
        }
        
        const row = `
            <tr class="${rowClass}">
                <td><strong>${arch.architecture}</strong></td>
                <td>${arch.macro_f1 || 0}%</td>
                <td>${arch.val_accuracy || 0}%</td>
                <td>${arch.macro_precision || 0}%</td>
                <td>${arch.macro_recall || 0}%</td>
                <td>${arch.inference_time_ms || 0}ms</td>
                <td>${arch.avg_memory_mb || 0}MB</td>
                <td>${arch.training_time_total || 0}s</td>
                <td>${(arch.total_params || 0).toLocaleString()}</td>
                <td>${arch.epochs_used || 0}</td>
                <td>${status}</td>
            </tr>
        `;
        tbody.append(row);
    });
}

// Fungsi untuk menampilkan best architecture info - DIPERBAIKI
function showBestArchitectureInfo(bestArchitecture, bestHyperparams, bestAccuracy, bestMacroF1, bestMacroPrecision, bestMacroRecall) {
    if (bestArchitecture) {
        $('#best-architecture-info').show();
        $('#best-architecture-name').text(bestArchitecture);
        $('#best-accuracy').text(bestAccuracy);
        $('#best-macro-f1').text(bestMacroF1);
        $('#best-macro-precision').text(bestMacroPrecision);
        $('#best-macro-recall').text(bestMacroRecall);
        $('#best-macro-f1-criteria').text(bestMacroF1);
        
        // Format hyperparameters lebih rapi
        if (bestHyperparams) {
            const hyperparamsText = `
                Optimizer: <strong>${bestHyperparams.optimizer}</strong>, 
                Learning Rate: <strong>${bestHyperparams.learning_rate}</strong>, 
                Batch Size: <strong>${bestHyperparams.batch_size}</strong>,
                Dropout: <strong>${bestHyperparams.dropout_rate}</strong>,
                L2: <strong>${bestHyperparams.l2_rate}</strong>
            `;
            $('#best-hyperparams').html(hyperparamsText);
        }
    } else {
        $('#best-architecture-info').hide();
    }
}

// Fungsi untuk menampilkan perbandingan arsitektur - DIPERBAIKI
function renderArchitectureComparison(res) {
    if (res.has_visualization_data && res.architecture_comparison && res.training_histories) {
        $('#architecture-comparison').show();
        $('#consistency-check').show();
        
        // Simpan data untuk resize
        currentComparisonData = res.architecture_comparison;
        currentTrainingHistories = res.training_histories;
        
        // Urutkan data arsitektur jika diperlukan - DITAMBAHKAN
        if (res.architecture_results) {
            res.architecture_results = sortArchitectureData(res.architecture_results);
        }
        
        // üéØ GUNAKAN DATA DARI best_architecture_result JIKA ADA
        let bestAccuracy, bestMacroF1, bestMacroPrecision, bestMacroRecall;
        
        if (res.best_architecture_result) {
            // Data langsung dari best_architecture_result (paling akurat)
            bestAccuracy = res.best_architecture_result.val_accuracy || 0;
            bestMacroF1 = res.best_architecture_result.macro_f1 || 0;
            bestMacroPrecision = res.best_architecture_result.macro_precision || 0;
            bestMacroRecall = res.best_architecture_result.macro_recall || 0;
            
            console.log("üéØ Menggunakan data dari best_architecture_result:", {
                architecture: res.best_architecture,
                accuracy: bestAccuracy,
                macroF1: bestMacroF1
            });
        } else if (res.architecture_results) {
            // Fallback: cari yang terbaik dari architecture_results
            const bestArch = res.architecture_results.reduce((best, current) => {
                const currentF1 = current.macro_f1 || 0;
                const bestF1 = best.macro_f1 || 0;
                return currentF1 > bestF1 ? current : best;
            });
            
            bestAccuracy = bestArch.val_accuracy || 0;
            bestMacroF1 = bestArch.macro_f1 || 0;
            bestMacroPrecision = bestArch.macro_precision || 0;
            bestMacroRecall = bestArch.macro_recall || 0;
            
            console.log("‚ö†Ô∏è Menggunakan data fallback dari architecture_results");
        } else {
            // Data minimal
            bestAccuracy = res.best_accuracy || 0;
            bestMacroF1 = res.best_macro_f1 || 0;
            bestMacroPrecision = res.best_macro_precision || 0;
            bestMacroRecall = res.best_macro_recall || 0;
        }
        
        // Tampilkan best architecture info dengan data yang KONSISTEN
        showBestArchitectureInfo(
            res.best_architecture, 
            res.best_hyperparams, 
            bestAccuracy, 
            bestMacroF1,
            bestMacroPrecision,
            bestMacroRecall
        );
        
        // Buat semua chart
        createPerformanceChart(res.architecture_comparison);
        createResourcesChart(res.architecture_comparison);
        createEfficiencyChart(res.architecture_comparison);
        createTrainingProgressCharts(res.training_histories);
        
        // Isi tabel perbandingan dengan data yang KONSISTEN
        renderComparisonTable(res.architecture_results, res.best_architecture);
        
        console.log("‚úÖ Architecture comparison berhasil dirender dengan data KONSISTEN");
        
        // Cek konsistensi otomatis
        setTimeout(() => {
            validateDataConsistency();
        }, 1000);
        
    } else {
        $('#architecture-comparison').hide();
        console.log("‚ö†Ô∏è Data visualisasi tidak tersedia untuk architecture comparison");
    }
}

// Fungsi untuk memuat data visualisasi saja - DIPERBAIKI
function loadVisualizationData() {
    $("#loading").show();
    $("#statusMessage").html('<div class="alert alert-info">Memuat data visualisasi dari cache...</div>');
    
    $.ajax({
        url: "/perhitungan/load-visualization-data",
        type: "GET",
        success: function(res) {
            $("#loading").hide();
            if (res.has_visualization_data) {
                renderArchitectureComparison(res);
                let successMsg = `<div class="alert alert-success">
                    <i class="icon-chart"></i> Data visualisasi berhasil dimuat dari cache.`;
                
                if (res.best_architecture) {
                    successMsg += `<br><strong>Arsitektur Terbaik:</strong> ${res.best_architecture} (Macro F1: ${res.best_macro_f1 || 0}%)`;
                }
                successMsg += `</div>`;
                
                $("#statusMessage").html(successMsg);
                console.log("‚úÖ Data visualisasi berhasil dimuat:", res);
            } else {
                let missingMsg = res.missing_components ? 
                    `Komponen yang hilang: ${res.missing_components.join(', ')}` : 
                    'Data tidak lengkap';
                    
                $("#statusMessage").html(`
                    <div class="alert alert-warning">
                        <i class="icon-warning"></i> ${res.message || "Data visualisasi tidak tersedia."}
                        <br><small>${missingMsg}</small>
                    </div>
                `);
                console.log("‚ùå Data visualisasi tidak lengkap:", res);
            }
        },
        error: function(xhr, status, error) {
            $("#loading").hide();
            let errorMsg = xhr.responseJSON?.error || error || "Unknown error";
            $("#statusMessage").html(`
                <div class="alert alert-danger">
                    <i class="icon-error"></i> Gagal memuat data visualisasi: ${errorMsg}
                </div>
            `);
            console.log("‚ùå Gagal memuat data visualisasi:", errorMsg);
        }
    });
}

// Fungsi untuk validasi konsistensi data
function validateDataConsistency() {
    $("#loading").show();
    
    $.ajax({
        url: "/perhitungan/validate-data-consistency",
        type: "GET",
        success: function(res) {
            $("#loading").hide();
            
            if (res.consistent) {
                $("#consistency-message").html(`
                    <span class="text-success">
                        <i class="icon-check"></i> ${res.message}
                    </span>
                    <br><small>Arsitektur terbaik: <strong>${res.best_architecture}</strong> memiliki data yang sama di semua tempat.</small>
                `);
                $("#consistency-check").removeClass('alert-info').addClass('alert-success');
            } else {
                let inconsistenciesHtml = "";
                if (res.inconsistencies && res.inconsistencies.length > 0) {
                    inconsistenciesHtml = "<ul class='mb-0'>";
                    res.inconsistencies.forEach(item => {
                        inconsistenciesHtml += `
                            <li>
                                <strong>${item.field}:</strong> 
                                Best Result=${item.best_result}%, 
                                Tabel=${item.table}% 
                                (Selisih: ${item.difference}%)
                            </li>
                        `;
                    });
                    inconsistenciesHtml += "</ul>";
                }
                
                $("#consistency-message").html(`
                    <span class="text-danger">
                        <i class="icon-warning"></i> ${res.message || "Ada ketidakkonsistenan data!"}
                    </span>
                    ${inconsistenciesHtml}
                `);
                $("#consistency-check").removeClass('alert-info alert-success').addClass('alert-danger');
            }
        },
        error: function(xhr) {
            $("#loading").hide();
            $("#consistency-message").html(`
                <span class="text-warning">
                    <i class="icon-error"></i> Gagal memvalidasi konsistensi data
                </span>
            `);
        }
    });
}

// =============================================
// FUNGSI UTAMA UNTUK RENDER DATA
// =============================================

function renderTable(data, totalRecords, displayedRecords) {
    if (!data || !data.length) {
        $("#reviews-table-body").html('<tr><td colspan="100" class="text-center">Tidak ada data untuk ditampilkan</td></tr>');
        return;
    }
    
    const headers = Object.keys(data[0]);
    
    $("#data-info").html(`
        <div class="alert alert-info">
            <i class="icon-info"></i> <strong>Info Data:</strong> 
            Menampilkan ${displayedRecords} dari ${totalRecords} total records. 
            <br><small>Proses perhitungan menggunakan semua data (${totalRecords} records) untuk akurasi maksimal.</small>
        </div>
    `);
    
    $("#table-header").html(`<tr><th>#</th>${headers.map(h => `<th>${h}</th>`).join('')}</tr>`);
    
    const tableRows = data.map((row, i) => {
        const cells = headers.map(h => {
            const mismatch = h === "Prediksi" && row["Status"] && row["Prediksi"] !== row["Status"];
            const cell = row[h] ?? "-";
            return `<td style="${mismatch ? 'background:#f8d7da;color:#721c24; font-weight:bold;' : ''}">${cell}</td>`;
        }).join("");
        
        return `<tr><td class="text-center">${i + 1}</td>${cells}</tr>`;
    }).join("");
    
    $("#reviews-table-body").html(tableRows);
}

function renderEvaluation(res) {
    if (!res.labels || !res.confusion) {
        $("#eval-info").html(`
            <div class="alert alert-warning">
                <i class="icon-warning"></i> Data evaluasi tidak tersedia.
            </div>
        `);
        return;
    }
    
    const labels = res.labels;
    
    // ... (kode render evaluation tetap sama)
    
    $("#eval-info").html(/* kode evaluation tetap sama */);
}

// =============================================
// EVENT HANDLERS DAN INISIALISASI
// =============================================

$(function () {
    // Event handlers untuk chart controls
    $('.chart-controls').on('click', 'button', function() {
        const chartType = $(this).data('chart');
        $('.chart-controls button').removeClass('active btn-outline-primary').addClass('btn-outline-secondary');
        $(this).removeClass('btn-outline-secondary').addClass('active btn-outline-primary');
        
        if (chartType === 'neuron-comparison') {
            $('#neuron-select').hide();
            $('#training-detail').hide();
            if (window.learningCurveData) {
                createLearningCurveChart(window.learningCurveData);
            }
        } else if (chartType === 'training-progress') {
            $('#neuron-select').show();
        }
    });

    // Event handler untuk architecture comparison chart types
    $('[data-chart-type]').click(function() {
        const chartType = $(this).data('chart-type');
        
        // Update button states
        $('[data-chart-type]').removeClass('active btn-outline-primary').addClass('btn-outline-secondary');
        $(this).removeClass('btn-outline-secondary').addClass('active btn-outline-primary');
        
        // Show/hide chart sections
        $('.chart-section').hide();
        $(`#${chartType}-chart`).show();
    });

    // Event handler untuk tombol validasi konsistensi
    $("#validate-consistency").click(function() {
        validateDataConsistency();
    });

    $("#run-consistency-check").click(function() {
        validateDataConsistency();
    });

    // Memuat data tersimpan saat halaman dimuat
    function loadSavedData() {
        $("#statusMessage").empty();
        $("#loading").show();
        
        $.ajax({
            url: "/perhitungan/load-result",
            type: "GET",
            success: res => {
                $("#loading").hide();
                if (res.train) {
                    renderTable(res.train, res.total_records || res.train.length, res.displayed_records || res.train.length);
                    renderEvaluation(res);
                    
                    // Tampilkan architecture comparison jika ada data
                    if (res.has_visualization_data) {
                        renderArchitectureComparison(res);
                    }
                    
                    $('#review-table-box').show();
                    $("#statusMessage").html(`<div class="alert alert-success"><i class="icon-check"></i> Data hasil berhasil dimuat.</div>`);
                } else if (res.message) {
                    $("#statusMessage").html(`<div class="alert alert-info">${res.message}</div>`);
                    if (res.train) {
                        renderTable(res.train, res.total_records, res.displayed_records);
                        $('#review-table-box').show();
                    }
                }
            },
            error: xhr => {
                $("#loading").hide();
                if (xhr.status === 404) {
                    $("#statusMessage").html(`<div class="alert alert-warning">${xhr.responseJSON?.error || "Tidak ada data tersimpan."}</div>`);
                } else {
                    $("#statusMessage").html(`<div class="alert alert-danger">${xhr.responseJSON?.error || "Gagal memuat data."}</div>`);
                }
            }
        });
    }

    // Fungsi untuk memeriksa hasil
    function checkExistingResult() {
        $.ajax({
            url: "/perhitungan/check-result",
            type: "GET",
            success: res => {
                if (res.has_result) {
                    $("#result-check").show();
                    $("#upload-form").hide();
                } else {
                    $("#result-check").hide();
                    $("#upload-form").show();
                }
            },
            error: () => {
                $("#result-check").hide();
                $("#upload-form").show();
            }
        });
    }
    
    // Panggil saat halaman dimuat
    checkExistingResult();
    
    // ... (kode event handler lainnya tetap sama)

    // Event handler untuk form submit - DIMODIFIKASI
    $("#upload-form").submit(function (e) {
        e.preventDefault();
        
        // Sembunyikan form upload setelah submit
        $("#upload-form").addClass('hidden-section');
        
        $("#statusMessage").empty();
        $("#loading").show();
        $("#optimization-results").hide();
        $("#architecture-comparison").hide();
        $("#review-table-box").hide();

        const formData = new FormData(this);
        $.ajax({
            url: "/perhitungan/process",
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: res => {
                $("#loading").hide();
                if (res.error) {
                    $("#statusMessage").html(`<div class="alert alert-danger">${res.error}</div>`);
                    // Tampilkan kembali form jika error
                    $("#upload-form").removeClass('hidden-section');
                } else {
                    $("#statusMessage").html(`<div class="alert alert-success">${res.message}</div>`);
                    
                    // Tampilkan perbandingan arsitektur
                    renderArchitectureComparison(res);
                    
                    if (res.train) {
                        renderTable(res.train, res.total_records, res.displayed_records);
                        renderEvaluation(res);
                        $('#review-table-box').show();
                    }
                }
            },
            error: xhr => {
                $("#loading").hide();
                let errorMsg = "Gagal memproses.";
                if (xhr.responseJSON && xhr.responseJSON.error) {
                    errorMsg = xhr.responseJSON.error;
                } else if (xhr.status === 0) {
                    errorMsg = "Koneksi terputus. Periksa koneksi internet Anda.";
                }
                $("#statusMessage").html(`<div class="alert alert-danger">${errorMsg}</div>`);
                // Tampilkan kembali form jika error
                $("#upload-form").removeClass('hidden-section');
            }
        });
    });

    // =============================================
// EVENT HANDLERS DAN INISIALISASI
// =============================================

$(function () {
    // Event handlers untuk chart controls
    $('.chart-controls').on('click', 'button', function() {
        const chartType = $(this).data('chart');
        $('.chart-controls button').removeClass('active btn-outline-primary').addClass('btn-outline-secondary');
        $(this).removeClass('btn-outline-secondary').addClass('active btn-outline-primary');
        
        if (chartType === 'neuron-comparison') {
            $('#neuron-select').hide();
            $('#training-detail').hide();
            if (window.learningCurveData) {
                createLearningCurveChart(window.learningCurveData);
            }
        } else if (chartType === 'training-progress') {
            $('#neuron-select').show();
        }
    });

    // Event handler untuk architecture comparison chart types
    $('[data-chart-type]').click(function() {
        const chartType = $(this).data('chart-type');
        
        // Update button states
        $('[data-chart-type]').removeClass('active btn-outline-primary').addClass('btn-outline-secondary');
        $(this).removeClass('btn-outline-secondary').addClass('active btn-outline-primary');
        
        // Show/hide chart sections
        $('.chart-section').hide();
        $(`#${chartType}-chart`).show();
    });

    // Event handler untuk select neuron
    $('#neuron-select').change(function() {
        const selectedNeuron = parseInt($(this).val());
        if (selectedNeuron) {
            showTrainingProgress(selectedNeuron);
        } else {
            $('#training-detail').hide();
        }
    });

    // Event handler untuk view training detail dari grid results
    $(document).on('click', '.view-training', function() {
        const neurons = parseInt($(this).data('neurons'));
        $('.chart-controls button[data-chart="training-progress"]').click();
        $('#neuron-select').val(neurons).trigger('change');
    });

    // Memuat data tersimpan saat halaman dimuat
    function loadSavedData() {
        $("#statusMessage").empty();
        $("#loading").show();
        
        $.ajax({
            url: "/perhitungan/load-result",
            type: "GET",
            success: res => {
                $("#loading").hide();
                if (res.train) {
                    renderTable(res.train, res.total_records || res.train.length, res.displayed_records || res.train.length);
                    renderEvaluation(res);
                    
                    // Tampilkan architecture comparison jika ada data
                    if (res.has_visualization_data) {
                        renderArchitectureComparison(res);
                    }
                    
                    $('#review-table-box').show();
                    $("#statusMessage").html(`<div class="alert alert-success"><i class="icon-check"></i> Data hasil berhasil dimuat.</div>`);
                } else if (res.message) {
                    $("#statusMessage").html(`<div class="alert alert-info">${res.message}</div>`);
                    if (res.train) {
                        renderTable(res.train, res.total_records, res.displayed_records);
                        $('#review-table-box').show();
                    }
                }
            },
            error: xhr => {
                $("#loading").hide();
                if (xhr.status === 404) {
                    $("#statusMessage").html(`<div class="alert alert-warning">${xhr.responseJSON?.error || "Tidak ada data tersimpan."}</div>`);
                } else {
                    $("#statusMessage").html(`<div class="alert alert-danger">${xhr.responseJSON?.error || "Gagal memuat data."}</div>`);
                }
            }
        });
    }

    // Fungsi untuk memeriksa hasil
    function checkExistingResult() {
        $.ajax({
            url: "/perhitungan/check-result",
            type: "GET",
            success: res => {
                if (res.has_result) {
                    $("#result-check").show();
                    $("#upload-form").hide();
                } else {
                    $("#result-check").hide();
                    $("#upload-form").show();
                }
            },
            error: () => {
                $("#result-check").hide();
                $("#upload-form").show();
            }
        });
    }
    
    // Panggil saat halaman dimuat
    checkExistingResult();
    
    // Event handler untuk tombol gunakan hasil sebelumnya - DIMODIFIKASI
    $("#use-existing").click(() => {
        // Sembunyikan opsi pilihan
        hideSelectionOptions();
        
        $("#loading").show();
        $("#statusMessage").empty();
        $("#optimization-results").hide();
        $("#architecture-comparison").hide();
        
        $.ajax({
            url: "/perhitungan/process",
            type: "POST",
            data: new FormData(),
            processData: false,
            contentType: false,
            success: res => {
                $("#loading").hide();
                if (res.error) {
                    $("#statusMessage").html(`<div class="alert alert-danger">${res.error}</div>`);
                } else {
                    $("#statusMessage").html(`<div class="alert alert-success">${res.message}</div>`);
                    
                    // Tampilkan hasil optimasi jika ada
                    renderOptimizationResults(res);
                    
                    // Tampilkan perbandingan arsitektur
                    renderArchitectureComparison(res);
                    
                    if (res.train) {
                        renderTable(res.train, res.total_records, res.displayed_records);
                        renderEvaluation(res);
                        $('#review-table-box').show();
                    }
                }
            },
            error: xhr => {
                $("#loading").hide();
                $("#statusMessage").html(`<div class="alert alert-danger">${xhr.responseJSON?.error || "Gagal memuat data."}</div>`);
            }
        });
    });
    
    // Event handler untuk tombol latih model baru - DIMODIFIKASI
    $("#train-new").click(() => {
        // Sembunyikan opsi pilihan
        hideSelectionOptions();
        
        $("#upload-form").show();
        $("#optimization-results").hide();
        $("#architecture-comparison").hide();
    });

    // Event handler untuk tombol muat data visualisasi
    $("#load-visualization-data").click(() => {
        loadVisualizationData();
    });

    // Event handler untuk tombol debug cache
    $("#debug-cache").click(() => {
        debugCache();
    });

    // Event handler untuk form submit - DIMODIFIKASI
    $("#upload-form").submit(function (e) {
        e.preventDefault();
        
        // Sembunyikan form upload setelah submit
        $("#upload-form").addClass('hidden-section');
        
        $("#statusMessage").empty();
        $("#loading").show();
        $("#optimization-results").hide();
        $("#architecture-comparison").hide();
        $("#review-table-box").hide();

        const formData = new FormData(this);
        $.ajax({
            url: "/perhitungan/process",
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: res => {
                $("#loading").hide();
                if (res.error) {
                    $("#statusMessage").html(`<div class="alert alert-danger">${res.error}</div>`);
                    // Tampilkan kembali form jika error
                    $("#upload-form").removeClass('hidden-section');
                } else {
                    $("#statusMessage").html(`<div class="alert alert-success">${res.message}</div>`);
                    
                    // Tampilkan hasil optimasi
                    renderOptimizationResults(res);
                    
                    // Tampilkan perbandingan arsitektur
                    renderArchitectureComparison(res);
                    
                    if (res.train) {
                        renderTable(res.train, res.total_records, res.displayed_records);
                        renderEvaluation(res);
                        $('#review-table-box').show();
                    }
                }
            },
            error: xhr => {
                $("#loading").hide();
                let errorMsg = "Gagal memproses.";
                if (xhr.responseJSON && xhr.responseJSON.error) {
                    errorMsg = xhr.responseJSON.error;
                } else if (xhr.status === 0) {
                    errorMsg = "Koneksi terputus. Periksa koneksi internet Anda.";
                }
                $("#statusMessage").html(`<div class="alert alert-danger">${errorMsg}</div>`);
                // Tampilkan kembali form jika error
                $("#upload-form").removeClass('hidden-section');
            }
        });
    });

    $("#clear-data").click(() => {
        if (confirm("Apakah Anda yakin ingin menghapus semua data dan model? Tindakan ini tidak dapat dibatalkan.")) {
            $.post("/perhitungan/clear", res => {
                $("#statusMessage").html(`<div class="alert alert-info">${res.message}</div>`);
                $("#table-header, #reviews-table-body, #eval-info, #data-info").empty();
                $('#review-table-box').hide();
                $('#optimization-results').hide();
                $('#architecture-comparison').hide();
                
                // Tampilkan kembali opsi pilihan setelah clear
                $("#result-check").removeClass('hidden-section').show();
                checkExistingResult();
            }).fail(() => {
                $("#statusMessage").html(`<div class="alert alert-danger">Gagal menghapus data.</div>`);
            });
        }
    });

    $("#load-saved-data").click(() => {
        loadSavedData();
    });
});
</script>

{% endblock %}